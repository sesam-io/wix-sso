{"mappings":"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","sources":["<anon>","src/index.ts","src/runSSOFlow.ts","src/logger.ts","src/constants.ts","src/types.ts","src/analytics.ts","src/updateHttpFunctions.ts","src/loadScript.ts","src/readCurrentScriptSiteId.ts"],"sourcesContent":["(() => {\nconst $a586fa59241635e0$export$fdceead422f56282 = \"https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js\";\nconst $a586fa59241635e0$export$b6076d1cb98730e7 = \"https://static.zdassets.com/ekr/snippet.js?key=eb7f5552-be33-4b0f-a55d-ce9a8a7aa975\";\nconst $a586fa59241635e0$export$31098c40fac339ea = \"_logSSOFlow_\";\nconst $a586fa59241635e0$export$89711068e98820c5 = `${window.location.origin}/callback`;\n\n\nconst $12280d181e54d516$var$getLoggerFn = (enabled = false)=>(title, ...args)=>{\n        if (!enabled) return;\n        console.info(`SSO FLow - ${title}`, args.length ? args : \"\", new Date().toLocaleTimeString());\n    };\nconst $12280d181e54d516$var$enabled = Boolean(localStorage.getItem((0, $a586fa59241635e0$export$31098c40fac339ea)));\nconst $12280d181e54d516$export$bef1f36f5486a6a3 = $12280d181e54d516$var$getLoggerFn($12280d181e54d516$var$enabled);\n\n\nvar $4af316b4eed61e46$export$c9ef5458120c5543;\n(function(LoginMessageType) {\n    LoginMessageType[\"Login\"] = \"auth0:login\";\n    LoginMessageType[\"Logout\"] = \"auth0:logout\";\n    LoginMessageType[\"Signup\"] = \"auth0:signup\";\n})($4af316b4eed61e46$export$c9ef5458120c5543 || ($4af316b4eed61e46$export$c9ef5458120c5543 = {}));\n\n\n\nconst $18e77616e3b08fc9$var$waitForDataLayer = (callback, attempt = 0)=>{\n    (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"Waiting for GA dataLayer\", JSON.stringify(window.dataLayer), \". Attempt: \", attempt);\n    const max_attempts = 10;\n    if (attempt > max_attempts) {\n        (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"Waiting for GA dataLayer: Max attempts reached.\");\n        return;\n    }\n    if (window.dataLayer) {\n        (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"GA dataLayer found\");\n        callback();\n    } else setTimeout(function() {\n        $18e77616e3b08fc9$var$waitForDataLayer(callback, attempt + 1);\n    }, 500);\n};\nfunction $18e77616e3b08fc9$export$3c27964bdf7ca185() {\n    (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"Attempting to push user_id to GA dataLayer.\");\n    const args = arguments;\n    $18e77616e3b08fc9$var$waitForDataLayer(()=>{\n        (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"Setting the user-id\");\n        window.dataLayer.push(args);\n        (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"window.dataLayer after pushing\", window.dataLayer);\n    });\n}\nasync function $18e77616e3b08fc9$export$bced8d2aada2d1c9(message) {\n    // encode as UTF-8\n    const msgBuffer = new TextEncoder().encode(message);\n    // hash the message\n    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", msgBuffer);\n    // convert ArrayBuffer to Array\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    // convert bytes to hex string                  \n    const hashHex = hashArray.map((b)=>b.toString(16).padStart(2, \"0\")).join(\"\");\n    return hashHex;\n}\n\n\n\nconst $e412bb44792c0e5d$export$36cb72b0e241b243 = (auth0Client, auth0Id)=>{\n    return new Promise(async (resolve, _reject)=>{\n        (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"updateHttpFunctions called\");\n        const user = await auth0Client.getUser();\n        if (!user) {\n            (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"updateHttpFunctions -> user not logged-in!\");\n            return;\n        }\n        if (!auth0Id) {\n            (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"updateHttpFunctions -> auth0Id is not defined!\");\n            return;\n        }\n        try {\n            await fetch(window.location.origin + \"/_functions/auth0/\" + auth0Id, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    user: user\n                })\n            });\n            const token = await auth0Client.getTokenSilently();\n            await fetch(window.location.origin + \"/_functions/auth0/\" + auth0Id, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    token: token\n                })\n            });\n            resolve();\n        } catch (err) {\n            console.error(\"fetch error: \", err);\n            _reject();\n        }\n    });\n};\n\n\n\nconst $a98fa00f2416e6ea$export$91a760dcae1633b7 = (args)=>{\n    const { auth0ClientOptions: auth0ClientOptions, siteId: siteId } = args;\n    (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"runSSOFlow start\");\n    if (!window?.auth0) {\n        (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"auth0 does not exist!\");\n        return;\n    }\n    let auth0Id = \"\";\n    (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"runSSOFlow ~ auth0Id:\", auth0Id);\n    let zToken = \"\";\n    const auth0Client = new window.auth0.Auth0Client(auth0ClientOptions);\n    const afterAuthentication = async ()=>{\n        (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"afterAuthentication invoked!\");\n        const isAuthenticated = await auth0Client.isAuthenticated();\n        if (isAuthenticated) {\n            (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"user is authenticated\");\n            return;\n        }\n        const query = window.location.search;\n        if (query.includes(\"code=\") && query.includes(\"state=\")) {\n            await auth0Client.handleRedirectCallback();\n            await (0, $e412bb44792c0e5d$export$36cb72b0e241b243)(auth0Client, auth0Id);\n            window.history.replaceState({}, \"\", \"/\");\n        }\n    };\n    // I'm not quite sure how Wix works but it's important to note that this window.onload only runs\n    // when we refresh the page - not when going through the pages within the Wix site, In that sense, Wix is SPA-ish\n    window.onload = async ()=>{\n        (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"window has loaded\");\n        window.zE(\"messenger\", \"hide\");\n    };\n    afterAuthentication();\n    window.addEventListener(\"message\", async (event)=>{\n        if (event.data.auth0Id) {\n            (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"message data\", event.data);\n            auth0Id = event.data.auth0Id;\n            zToken = event.data.zendeskToken;\n            const user = await auth0Client.getUser();\n            if (user?.email) {\n                const hashedEmail = await (0, $18e77616e3b08fc9$export$bced8d2aada2d1c9)(user.email);\n                // @ts-ignore\n                (0, $18e77616e3b08fc9$export$3c27964bdf7ca185)(\"set\", {\n                    user_id: hashedEmail\n                });\n            }\n            if (zToken) {\n                (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"message - zToken\", zToken);\n                window.zE(\"messenger\", \"loginUser\", function(callback) {\n                    callback(zToken);\n                    window.zE(\"messenger\", \"show\");\n                });\n            } else await (0, $e412bb44792c0e5d$export$36cb72b0e241b243)(auth0Client, auth0Id);\n        }\n        if (event.data === (0, $4af316b4eed61e46$export$c9ef5458120c5543).Login) {\n            (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"message - \", (0, $4af316b4eed61e46$export$c9ef5458120c5543).Login);\n            await auth0Client.loginWithRedirect({\n                authorizationParams: {\n                    redirect_uri: (0, $a586fa59241635e0$export$89711068e98820c5),\n                    \"ext-site_id\": siteId\n                }\n            });\n        }\n        if (event.data === (0, $4af316b4eed61e46$export$c9ef5458120c5543).Logout) {\n            (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"message - \", (0, $4af316b4eed61e46$export$c9ef5458120c5543).Logout);\n            auth0Client.logout({\n                logoutParams: {\n                    returnTo: window.location.origin\n                }\n            });\n        }\n        if (event.data === (0, $4af316b4eed61e46$export$c9ef5458120c5543).Signup) {\n            (0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"message - \", (0, $4af316b4eed61e46$export$c9ef5458120c5543).Signup);\n            auth0Client.loginWithRedirect({\n                authorizationParams: {\n                    redirect_uri: (0, $a586fa59241635e0$export$89711068e98820c5),\n                    screen_hint: \"signup\",\n                    \"ext-site_id\": siteId\n                }\n            });\n        }\n    });\n};\n\n\n\n\nconst $3b33cf2624045b0c$export$2cb99e4be0dc4646 = (args)=>{\n    const { url: url, idAttribute: idAttribute, name: name } = args;\n    return new Promise((resolve, _reject)=>{\n        const head = document.head;\n        const script = document.createElement(\"script\");\n        script.type = \"text/javascript\";\n        script.src = url;\n        script.id = idAttribute ?? \"\";\n        script.onload = ()=>{\n            (0, $12280d181e54d516$export$bef1f36f5486a6a3)(`${name} script loaded`);\n            resolve();\n        };\n        head.appendChild(script);\n    });\n};\n\n\n\nconst $8fb173d617280e0e$export$980c796d7aa95057 = ()=>document?.currentScript?.attributes.getNamedItem(\"data-siteid\")?.value;\n\n\nconst $c2848ebcf924d7cd$var$siteId = (0, $8fb173d617280e0e$export$980c796d7aa95057)();\n(0, $12280d181e54d516$export$bef1f36f5486a6a3)(\"siteId\", $c2848ebcf924d7cd$var$siteId);\nconst $c2848ebcf924d7cd$var$promise = (0, $3b33cf2624045b0c$export$2cb99e4be0dc4646)({\n    url: (0, $a586fa59241635e0$export$fdceead422f56282),\n    name: \"Auth0 SPA js\"\n});\n$c2848ebcf924d7cd$var$promise.then(()=>{\n    (0, $3b33cf2624045b0c$export$2cb99e4be0dc4646)({\n        url: (0, $a586fa59241635e0$export$b6076d1cb98730e7),\n        name: \"Zendesk widget\",\n        idAttribute: \"ze-snippet\"\n    }).then(()=>{\n        (0, $a98fa00f2416e6ea$export$91a760dcae1633b7)({\n            auth0ClientOptions: {\n                domain: \"accounts.talk.sesam.io\",\n                clientId: \"kJpPOS30v8dpD68iRJ7PMdS03Hwvq06X\"\n            },\n            siteId: $c2848ebcf924d7cd$var$siteId\n        });\n    });\n});\n\n})();\n//# sourceMappingURL=sso-flow.min.js.map\n","import { runSSOFlow } from \"./runSSOFlow\";\nimport { Auth0_SPA_JS_CDN, ZENDESK_WIDGET_CDN } from \"./constants\";\nimport { loadScript } from \"./loadScript\";\nimport { log } from \"./logger\";\nimport { readCurrentScriptSiteId } from \"./readCurrentScriptSiteId\";\n\nconst siteId = readCurrentScriptSiteId();\nlog(\"siteId\", siteId);\n\nconst promise = loadScript({\n  url: Auth0_SPA_JS_CDN,\n  name: \"Auth0 SPA js\",\n});\n\npromise.then(() => {\n  loadScript({\n    url: ZENDESK_WIDGET_CDN,\n    name: \"Zendesk widget\",\n    idAttribute: \"ze-snippet\",\n  }).then(() => {\n    runSSOFlow({\n      auth0ClientOptions: {\n        domain: \"accounts.talk.sesam.io\",\n        clientId: \"kJpPOS30v8dpD68iRJ7PMdS03Hwvq06X\",\n      },\n      siteId,\n    });\n  });\n});\n","import { log } from \"./logger\";\nimport type { RunSSOFlowArgs } from \"./types\";\nimport { LoginMessageType } from \"./types\";\nimport { pushToDataLayer, sha256 } from \"./analytics\";\nimport { updateHttpFunctions } from \"./updateHttpFunctions\";\nimport { REDIRECT_URI } from \"./constants\";\n\nexport const runSSOFlow = (args: RunSSOFlowArgs) => {\n  const { auth0ClientOptions, siteId } = args;\n\n  log(\"runSSOFlow start\");\n\n  if (!window?.auth0) {\n    log(\"auth0 does not exist!\");\n    return;\n  }\n\n  let auth0Id = \"\";\n  log(\"runSSOFlow ~ auth0Id:\", auth0Id);\n  let zToken = \"\";\n\n  const auth0Client = new window.auth0.Auth0Client(auth0ClientOptions);\n\n  const afterAuthentication = async () => {\n    log(\"afterAuthentication invoked!\");\n\n    const isAuthenticated = await auth0Client.isAuthenticated();\n\n    if (isAuthenticated) {\n      log(\"user is authenticated\");\n      return;\n    }\n\n    const query = window.location.search;\n\n    if (query.includes(\"code=\") && query.includes(\"state=\")) {\n      await auth0Client.handleRedirectCallback();\n      await updateHttpFunctions(auth0Client, auth0Id);\n\n      window.history.replaceState({}, \"\", \"/\");\n    }\n  };\n\n  // I'm not quite sure how Wix works but it's important to note that this window.onload only runs\n  // when we refresh the page - not when going through the pages within the Wix site, In that sense, Wix is SPA-ish\n  window.onload = async () => {\n    log(\"window has loaded\");\n\n    window.zE(\"messenger\", \"hide\");\n  };\n\n  afterAuthentication();\n\n  window.addEventListener(\"message\", async (event) => {\n    if (event.data.auth0Id) {\n      log(\"message data\", event.data);\n      auth0Id = event.data.auth0Id;\n      zToken = event.data.zendeskToken;\n\n      const user = await auth0Client.getUser();\n\n      if (user?.email) {\n        const hashedEmail = await sha256(user.email);\n        // @ts-ignore\n        pushToDataLayer(\"set\", { user_id: hashedEmail });\n      }\n\n      if (zToken) {\n        log(\"message - zToken\", zToken);\n\n        window.zE(\n          \"messenger\",\n          \"loginUser\",\n          function (callback: ZendeskCallbackFn) {\n            callback(zToken);\n            window.zE(\"messenger\", \"show\");\n          }\n        );\n      } else {\n        await updateHttpFunctions(auth0Client, auth0Id);\n      }\n    }\n\n    if (event.data === LoginMessageType.Login) {\n      log(\"message - \", LoginMessageType.Login);\n\n      await auth0Client.loginWithRedirect({\n        authorizationParams: {\n          redirect_uri: REDIRECT_URI,\n          \"ext-site_id\": siteId,\n        },\n      });\n    }\n\n    if (event.data === LoginMessageType.Logout) {\n      log(\"message - \", LoginMessageType.Logout);\n\n      auth0Client.logout({\n        logoutParams: {\n          returnTo: window.location.origin,\n        },\n      });\n    }\n\n    if (event.data === LoginMessageType.Signup) {\n      log(\"message - \", LoginMessageType.Signup);\n\n      auth0Client.loginWithRedirect({\n        authorizationParams: {\n          redirect_uri: REDIRECT_URI,\n          screen_hint: \"signup\",\n          \"ext-site_id\": siteId,\n        },\n      });\n    }\n  });\n};\n","import { LOG_STORAGE_KEY } from \"./constants\";\n\nconst getLoggerFn =\n  (enabled = false) =>\n  (title: string, ...args: any[]) => {\n    if (!enabled) {\n      return;\n    }\n\n    console.info(\n      `SSO FLow - ${title}`,\n      args.length ? args : \"\",\n      new Date().toLocaleTimeString()\n    );\n  };\n\nconst enabled = Boolean(localStorage.getItem(LOG_STORAGE_KEY));\n\nexport const log = getLoggerFn(enabled);\n","export const Auth0_SPA_JS_CDN =\n  \"https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js\";\n\nexport const ZENDESK_WIDGET_CDN =\n  \"https://static.zdassets.com/ekr/snippet.js?key=eb7f5552-be33-4b0f-a55d-ce9a8a7aa975\";\n\nexport const LOG_STORAGE_KEY = \"_logSSOFlow_\";\n\nexport const REDIRECT_URI = `${window.location.origin}/callback`;\n","import type { Auth0ClientOptions } from \"@auth0/auth0-spa-js\";\n\nexport enum LoginMessageType {\n  Login = \"auth0:login\",\n  Logout = \"auth0:logout\",\n  Signup = \"auth0:signup\",\n}\n\nexport type RunSSOFlowArgs = {\n  auth0ClientOptions: Auth0ClientOptions;\n  siteId?: string | \"\";\n};\n\nexport type LoadScriptArgs = {\n  name: string;\n  idAttribute?: string;\n  url: string;\n};\n\n// The datalayer object is set on the window object by the Google Analytics script\n// it can be used to configure GA, set options or send specific events\ndeclare global {\n  interface Window {\n    dataLayer: any[];\n  }\n}\n","import { log } from \"./logger\";\n\nconst waitForDataLayer = (callback: Function, attempt = 0) => {\n  log(\"Waiting for GA dataLayer\", JSON.stringify(window.dataLayer), \". Attempt: \", attempt);\n  const max_attempts = 10;\n  if (attempt > max_attempts) {\n    log(\"Waiting for GA dataLayer: Max attempts reached.\")\n    return;\n  }\n  if (window.dataLayer) {\n    log(\"GA dataLayer found\");\n    callback();\n  } else {\n    setTimeout(function () {\n      waitForDataLayer(callback, attempt + 1);\n    }, 500);\n  }\n};\n\n/**\n * Configure the GA object, set parameters or send events\n * This code is modified from the pure-js code given by Google Analytics that looks like this\n *   window.dataLayer = window.dataLayer || [];\n *   function gtag(){dataLayer.push(arguments);}\n *   gtag('js', new Date());\n *   gtag('config', '<id>');\n * @param args arbitrary arguments to the Google Analytics object (set, event, etc.\n */\nexport function pushToDataLayer() {\n  log(\"Attempting to push user_id to GA dataLayer.\")\n  const args = arguments;\n  waitForDataLayer(() => {\n    log(\"Setting the user-id\");\n    window.dataLayer.push(args);\n    log(\"window.dataLayer after pushing\", window.dataLayer);\n  });\n};\n\nexport async function sha256(message: string): Promise<string> {\n  // encode as UTF-8\n  const msgBuffer = new TextEncoder().encode(message);\n\n  // hash the message\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n\n  // convert ArrayBuffer to Array\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n\n  // convert bytes to hex string                  \n  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n  return hashHex;\n}\n","import type { Auth0Client } from \"@auth0/auth0-spa-js\";\nimport { log } from \"./logger\";\n\nexport const updateHttpFunctions = (\n  auth0Client: Auth0Client,\n  auth0Id: string\n) => {\n  return new Promise<void>(async (resolve, _reject) => {\n    log(\"updateHttpFunctions called\");\n\n    const user = await auth0Client.getUser();\n\n    if (!user) {\n      log(\"updateHttpFunctions -> user not logged-in!\");\n      return;\n    }\n\n    if (!auth0Id) {\n      log(\"updateHttpFunctions -> auth0Id is not defined!\");\n      return;\n    }\n\n    try {\n      await fetch(window.location.origin + \"/_functions/auth0/\" + auth0Id, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ user }),\n      });\n\n      const token = await auth0Client.getTokenSilently();\n\n      await fetch(window.location.origin + \"/_functions/auth0/\" + auth0Id, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ token }),\n      });\n\n      resolve();\n    } catch (err) {\n      console.error(\"fetch error: \", err);\n      _reject();\n    }\n  });\n};\n","import { log } from \"./logger\";\nimport { LoadScriptArgs } from \"./types\";\n\nexport const loadScript = (args: LoadScriptArgs) => {\n  const { url, idAttribute, name } = args;\n\n  return new Promise<void>((resolve, _reject) => {\n    const head = document.head;\n    const script = document.createElement(\"script\");\n    script.type = \"text/javascript\";\n    script.src = url;\n    script.id = idAttribute ?? \"\";\n\n    script.onload = () => {\n      log(`${name} script loaded`);\n\n      resolve();\n    };\n\n    head.appendChild(script);\n  });\n};\n","export const readCurrentScriptSiteId = () =>\n  document?.currentScript?.attributes.getNamedItem(\"data-siteid\")?.value;\n"],"names":["$4af316b4eed61e46$export$c9ef5458120c5543","LoginMessageType","$a586fa59241635e0$export$89711068e98820c5","window","location","origin","$12280d181e54d516$var$enabled","Boolean","localStorage","getItem","$12280d181e54d516$export$bef1f36f5486a6a3","$12280d181e54d516$var$getLoggerFn","enabled","title","args","console","info","length","Date","toLocaleTimeString","$18e77616e3b08fc9$var$waitForDataLayer","callback","attempt","JSON","stringify","dataLayer","setTimeout","$18e77616e3b08fc9$export$bced8d2aada2d1c9","message","msgBuffer","TextEncoder","encode","hashBuffer","crypto","subtle","digest","hashArray","Array","from","Uint8Array","hashHex","map","b","toString","padStart","join","$e412bb44792c0e5d$export$36cb72b0e241b243","auth0Client","auth0Id","Promise","resolve","_reject","user","getUser","fetch","method","headers","body","token","getTokenSilently","err","error","$a98fa00f2416e6ea$export$91a760dcae1633b7","auth0ClientOptions","siteId","auth0","zToken","Auth0Client","afterAuthentication","isAuthenticated","query","search","includes","handleRedirectCallback","history","replaceState","onload","zE","addEventListener","event","data","zendeskToken","email","hashedEmail","arguments","push","user_id","Login","loginWithRedirect","authorizationParams","redirect_uri","Logout","logout","logoutParams","returnTo","Signup","screen_hint","$3b33cf2624045b0c$export$2cb99e4be0dc4646","url","idAttribute","name","head","document","script","createElement","type","src","id","appendChild","$c2848ebcf924d7cd$var$siteId","currentScript","attributes","getNamedItem","value","$c2848ebcf924d7cd$var$promise","then","domain","clientId"],"version":3,"file":"sso-flow.min.js.map"}