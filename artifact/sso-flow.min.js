!function(){function t(t,e,n,r,a,i,o){try{var u=t[i](o),s=u.value}catch(t){n(t);return}u.done?e(s):Promise.resolve(s).then(r,a)}function e(e){return function(){var n=this,r=arguments;return new Promise(function(a,i){var o=e.apply(n,r);function u(e){t(o,a,i,u,s,"next",e)}function s(e){t(o,a,i,u,s,"throw",e)}u(void 0)})}}function n(t,e){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){return function(u){if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&u[0]?r.return:u[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,u[1])).done)return a;switch(r=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){o.label=u[1];break}if(6===u[0]&&o.label<a[1]){o.label=a[1],a=u;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(u);break}a[2]&&o.ops.pop(),o.trys.pop();continue}u=e.call(t,o)}catch(t){u=[6,t],r=0}finally{n=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}"function"==typeof SuppressedError&&SuppressedError;var r,a,i,o,u="".concat(window.location.origin,"/callback"),s=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];t&&console.info("SSO FLow - ".concat(e),r.length?r:"",new Date().toLocaleTimeString())}}(!!localStorage.getItem("_logSSOFlow_"));(r=o||(o={})).Login="auth0:login",r.Logout="auth0:logout",r.Signup="auth0:signup";var c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(s("Waiting for GA dataLayer",JSON.stringify(window.dataLayer),". Attempt: ",e),e>10){s("Waiting for GA dataLayer: Max attempts reached.");return}window.dataLayer?(s("GA dataLayer found"),t()):setTimeout(function(){c(t,e+1)},500)};function l(){return(l=e(function(t){var e,r;return n(this,function(n){switch(n.label){case 0:return(// encode as UTF-8
e=new TextEncoder().encode(t),[4,crypto.subtle.digest("SHA-256",e)]);case 1:return r=n.sent(),[2,Array.from(new Uint8Array(r)).map(function(t){return t.toString(16).padStart(2,"0")}).join("")]}})})).apply(this,arguments)}var d=function(t,r){var a;return new Promise((a=e(function(e,a){var i,o;return n(this,function(n){switch(n.label){case 0:return s("updateHttpFunctions called"),[4,t.getUser()];case 1:if(!(i=n.sent()))return s("updateHttpFunctions -> user not logged-in!"),[2];if(!r)return s("updateHttpFunctions -> auth0Id is not defined!"),[2];n.label=2;case 2:return n.trys.push([2,6,,7]),[4,fetch(window.location.origin+"/_functions/auth0/"+r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:i})})];case 3:return n.sent(),[4,t.getTokenSilently()];case 4:return o=n.sent(),[4,fetch(window.location.origin+"/_functions/auth0/"+r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:o})})];case 5:return n.sent(),e(),[3,7];case 6:return console.error("fetch error: ",n.sent()),a(),[3,7];case 7:return[2]}})}),function(t,e){return a.apply(this,arguments)}))},f=function(t){var r,a,i=t.auth0ClientOptions,f=t.siteId;if(s("runSSOFlow start"),!(null==window?void 0:window.auth0)){s("auth0 does not exist!");return}var h="";s("runSSOFlow ~ auth0Id:",h);var p="",w=new window.auth0.Auth0Client(i),g=(r=e(function(){var t;return n(this,function(e){switch(e.label){case 0:return s("afterAuthentication invoked!"),[4,w.isAuthenticated()];case 1:if(e.sent())return s("user is authenticated"),[2];if(!((t=window.location.search).includes("code=")&&t.includes("state=")))return[3,4];return[4,w.handleRedirectCallback()];case 2:return e.sent(),[4,d(w,h)];case 3:e.sent(),window.history.replaceState({},"","/"),e.label=4;case 4:return[2]}})}),function(){return r.apply(this,arguments)});window.zE("messenger","hide"),g(),window.addEventListener("message",(a=e(function(t){var e;return n(this,function(n){switch(n.label){case 0:if(!t.data.auth0Id)return[3,6];return s("message data",t.data),h=t.data.auth0Id,p=t.data.zendeskToken,[4,w.getUser()];case 1:if(!(null==(e=n.sent())?void 0:e.email))return[3,3];return[4,function(t){return l.apply(this,arguments)}(e.email)];case 2:(function(){s("Attempting to push user_id to GA dataLayer.");var t=arguments;c(function(){s("Setting the user-id"),window.dataLayer.push(t),s("window.dataLayer after pushing",window.dataLayer)})})("set",{user_id:n.sent()}),n.label=3;case 3:if(!p)return[3,4];return s("message - zToken",p),window.location.pathname.includes("/callback")||window.zE("messenger","loginUser",function(t){t(p),window.zE("messenger","show")}),[3,6];case 4:return[4,d(w,h)];case 5:n.sent(),n.label=6;case 6:if(t.data!==o.Login)return[3,8];return s("message - ",o.Login),[4,w.loginWithRedirect({authorizationParams:{redirect_uri:u,"ext-site_id":f}})];case 7:n.sent(),n.label=8;case 8:return t.data===o.Logout&&(s("message - ",o.Logout),w.logout({logoutParams:{returnTo:window.location.origin}})),t.data===o.Signup&&(s("message - ",o.Signup),w.loginWithRedirect({authorizationParams:{redirect_uri:u,screen_hint:"signup","ext-site_id":f}})),[2]}})}),function(t){return a.apply(this,arguments)}))},h=function(t){var e=t.url,n=t.idAttribute,r=t.name;return new Promise(function(t,a){var i=document.head,o=document.createElement("script");o.type="text/javascript",o.src=e,o.id=null!=n?n:"",o.onload=function(){s("".concat(r," script loaded")),t()},i.appendChild(o)})},p=null==document?void 0:null===(i=document.currentScript)||void 0===i?void 0:null===(a=i.attributes.getNamedItem("data-siteid"))||void 0===a?void 0:a.value;s("siteId",p),h({url:"https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js",name:"Auth0 SPA js"}).then(function(){h({url:"https://static.zdassets.com/ekr/snippet.js?key=eb7f5552-be33-4b0f-a55d-ce9a8a7aa975",name:"Zendesk widget",idAttribute:"ze-snippet"}).then(function(){f({auth0ClientOptions:{domain:"accounts.talk.sesam.io",clientId:"kJpPOS30v8dpD68iRJ7PMdS03Hwvq06X"},siteId:p})})})}();