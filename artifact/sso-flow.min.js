(()=>{var t,e;let a=`${window.location.origin}/callback`,i=!!localStorage.getItem("_logSSOFlow_"),n=((t=!1)=>(e,...a)=>{t&&console.info(`SSO FLow - ${e}`,a.length?a:"",new Date().toLocaleTimeString())})(i);(e=t||(t={})).Login="auth0:login",e.Logout="auth0:logout",e.Signup="auth0:signup";let o=(t,e=0)=>{if(n("Waiting for GA dataLayer",JSON.stringify(window.dataLayer),". Attempt: ",e),e>10){n("Waiting for GA dataLayer: Max attempts reached.");return}window.dataLayer?(n("GA dataLayer found"),t()):setTimeout(function(){o(t,e+1)},500)};async function d(t){// encode as UTF-8
let e=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",e),i=Array.from(new Uint8Array(a)),n=i.map(t=>t.toString(16).padStart(2,"0")).join("");return n}let r=(t,e)=>new Promise(async(a,i)=>{n("updateHttpFunctions called");let o=await t.getUser();if(!o){n("updateHttpFunctions -> user not logged-in!");return}if(!e){n("updateHttpFunctions -> auth0Id is not defined!");return}try{await fetch(window.location.origin+"/_functions/auth0/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:o})});let i=await t.getTokenSilently();await fetch(window.location.origin+"/_functions/auth0/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:i})}),a()}catch(t){console.error("fetch error: ",t),i()}}),s=e=>{let{auth0ClientOptions:i,siteId:s}=e;if(n("runSSOFlow start"),!window?.auth0){n("auth0 does not exist!");return}let u="";n("runSSOFlow ~ auth0Id:",u);let l="",c=new window.auth0.Auth0Client(i),w=async()=>{n("afterAuthentication invoked!");let t=await c.isAuthenticated();if(t){n("user is authenticated");return}let e=window.location.search;e.includes("code=")&&e.includes("state=")&&(await c.handleRedirectCallback(),await r(c,u),window.history.replaceState({},"","/"))};// I'm not quite sure how Wix works but it's important to note that this window.onload only runs
// when we refresh the page - not when going through the pages within the Wix site, In that sense, Wix is SPA-ish
window.onload=async()=>{n("window has loaded"),window.zE("messenger","hide")},w(),window.addEventListener("message",async e=>{if(e.data.auth0Id){n("message data",e.data),u=e.data.auth0Id,l=e.data.zendeskToken;let t=await c.getUser();if(t?.email){let e=await d(t.email);!function(){n("Attempting to push user_id to GA dataLayer.");let t=arguments;o(()=>{n("Setting the user-id"),window.dataLayer.push(t),n("window.dataLayer after pushing",window.dataLayer)})}("set",{user_id:e})}l?(n("message - zToken",l),window.zE("messenger","loginUser",function(t){t(l),window.zE("messenger","show")})):await r(c,u)}e.data===t.Login&&(n("message - ",t.Login),await c.loginWithRedirect({authorizationParams:{redirect_uri:a,"ext-site_id":s}})),e.data===t.Logout&&(n("message - ",t.Logout),c.logout({logoutParams:{returnTo:window.location.origin}})),e.data===t.Signup&&(n("message - ",t.Signup),c.loginWithRedirect({authorizationParams:{redirect_uri:a,screen_hint:"signup","ext-site_id":s}}))})},u=t=>{let{url:e,idAttribute:a,name:i}=t;return new Promise((t,o)=>{let d=document.head,r=document.createElement("script");r.type="text/javascript",r.src=e,r.id=a??"",r.onload=()=>{n(`${i} script loaded`),t()},d.appendChild(r)})},l=document?.currentScript?.attributes.getNamedItem("data-siteid")?.value;n("siteId",l);let c=u({url:"https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js",name:"Auth0 SPA js"});c.then(()=>{u({url:"https://static.zdassets.com/ekr/snippet.js?key=eb7f5552-be33-4b0f-a55d-ce9a8a7aa975",name:"Zendesk widget",idAttribute:"ze-snippet"}).then(()=>{s({auth0ClientOptions:{domain:"accounts.talk.sesam.io",clientId:"kJpPOS30v8dpD68iRJ7PMdS03Hwvq06X"},siteId:l})})})})();//# sourceMappingURL=sso-flow.min.js.map

//# sourceMappingURL=sso-flow.min.js.map
